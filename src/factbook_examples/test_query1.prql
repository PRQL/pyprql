#SELECT facts.code, cities.name, facts.population, SUM(facts.population) as total_pop
#from cities,
#     facts
#WHERE cities.facts_id = facts.id
#GROUP BY code
#ORDER BY total_pop DESC
#LIMIT 10;

from cities
join facts [facts_id=id]
select [cities.name,facts.population ]
aggregate by [ facts.code ] [
    urban_pop : "SUM(cities.population)",
    total_pop : "SUM(facts.population)"
]
filter cities.capital != 1
sort total_pop desc
take 10